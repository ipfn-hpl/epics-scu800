#######################################################
## vim: sta:et:sw=4:ts=4:sts=4
# ###                                             ### #
# ### EPICS Database for                          ### #
# ### SCU-800 Vacuum Contrller                    ### #
# ###                                             ### #
# ### author: B. Carvalho                         ### #
# ###                                             ### #
# ### Ref 1.0; 2022                               ### #
# ###                                             ### #
# ### macros: BUS     RS232/RS485 BUS name		  ### #
# ### 		  AD      RS485 address of SCU-800    ### #
# ###         CONVST  name of GPIO used as CONVST ### #
# ###         BUSY    name of GPIO used as BUSY   ### #
# ###                                             ### #
# ### Description:                                ### #
# ### This is an example DB file using            ### #
# ### stream(asynI2C) and devgpio to readout an   ### #
# ###                                             ### #
# ### Records ending in "__" are for internal use ### #
# ### only! Do not set them manually              ### #
# ###                                             ### #
#######################################################

################################################
# ### Reads the measured rotational speed  ### #
################################################
record(longin, $(P)$(R)01:ReadMeas){
    field(DESC, "Reads the measured rotational speed")
    field(DTYP, "stream")
    field(INP, "@edwards.proto ReadMeas('01') RS485")
    #field(PINI, "YES")
    field(VAL, "22")
    field(SCAN, "2 second")
    field(DISA, "1")
}
record(longin, $(P)$(R)02:ReadMeas){
    field(DESC, "Reads the measured rotational speed")
    field(DTYP, "stream")
    field(INP, "@edwards.proto ReadMeas('02') RS485")
    #field(PINI, "YES")
    field(VAL, "22")
    field(SCAN, "2 second")
    field(DISA, "1")
}
record(longin, $(P)$(R)01:ReadSetpoint){
    field(DESC, "Reads Speed SP & TMS temperature")
    field( DTYP, "stream" )
    field( INP,  "@edwards.proto ReadSetpoint('01') $(BUS)" )
  # Check Pump rpm rates
  # half of rated spped
    field(HIGH, "36000")
    field(HIHI, "40000")
    field(VAL, "666")
    field(EGU, "Hz")
    field(SCAN, "2 second")
    field(DISA, "1")
}
record(longin, $(P)$(R)01:ReadSetpointTMS){
    field(DESC, "Reads (Speed SP) & TMS temperature")
    field( DTYP, "stream" )
    field( INP,  "@edwards.proto ReadSetpointTMS('01') $(BUS)" )
  # Check Pump rpm rates
  # half of rated spped
    field(HIGH, "150")
    field(HIHI, "200")
    field(VAL, "55")
    field(EGU, "ÂºC")
    field(SCAN, "I/O Intr")
}
record(longin, $(P)$(R)02:ReadSetpoint){
    field(DESC, "Reads Speed SP & TMS temperature")
    field( DTYP, "stream" )
    field( INP,  "@edwards.proto ReadSetpoint('02') $(BUS)" )
  # Check Pump rpm rates
  # half of rated spped
    field(HIGH, "36000")
    field(HIHI, "40000")
    field(VAL, "666")
    field(EGU, "Hz")
    field(SCAN, "2 second")
    field(DISA, "1")
}
record(longout, $(P)$(R)01:SetSpeedSetpoint){
    field(DESC, "Reads the measured rotational speed")
    field( DTYP, "stream" )
    field( OUT,  "@edwards.proto SetSpeedSetpoint('01') $(BUS)")
    # Check Pump rpm rates. rated 35000 ~ 584 Hz
    field( DRVH, "584" )
    # half of rated spped
    field( DRVL, "292" )
    field(EGU, "Hz")
}
record(longin, $(P)$(R)01:ReadSpeedSetpoint){
    field(DESC, "Reads the the Speed Set Point value")
    field( DTYP, "stream" )
    field( INP,  "@edwards.proto ReadSpeedSetpoint('01') $(BUS)")
  # Check Pump rpm rates
  # half of rated spped
    field(HIGH, "36000")
    field(HIHI, "40000")
    field(VAL, "666")
    field(EGU, "Hz")
    field(SCAN, "2 second")
    field(DISA, "1")
    field(PINI, "YES")
}
record(longin, $(P)$(R)02:ReadSpeedSetpoint){
    field(DESC, "Reads the the Speed Set Point value")
    field( DTYP, "stream" )
    field( INP,  "@edwards.proto ReadSpeedSetpoint('02') $(BUS)")
  # Check Pump rpm rates
  # half of rated spped
    field(HIGH, "36000")
    field(HIHI, "40000")
    field(VAL, "666")
    field(EGU, "Hz")
    field(SCAN, "2 second")
    field(DISA, "1")
}
record(longin, $(P)$(R)01:ReadMotorTemp){
  field(DESC, "Reads the measured motor temperature")
  field(DTYP, "stream" )
  field(INP,  "@edwards.proto ReadMotorTemp('01') $(BUS)" )
  field(HIGH, "100")
  field(HIHI, "110")
  field(VAL, "1")
  field(EGU, "C")
  field(SCAN, "2 second")
  field(DISA, "1")
}
record(longin, $(P)$(R)02:ReadMotorTemp){
  field(DESC, "Reads the measured motor temperature")
  field(DTYP, "stream" )
  field(INP,  "@edwards.proto ReadMotorTemp('02') $(BUS)" )
  field(HIGH, "100")
  field(HIHI, "110")
  field(VAL, "1")
  field(EGU, "C")
  field(SCAN, "2 second")
  field(DISA, "1")
#  field(SCAN, "10 second")
}
record(longin, $(P)$(R)01a:ReadMeas){
    field(DESC, "Reads the measured rotational speed")
    field(DTYP, "stream")
    field(INP, "@edwards.proto ReadMeas('01') RS485")
    #field(PINI, "YES")
    field(VAL, "22")
    field(SCAN, "2 second")
    field(DISA, "1")
}
record(longin, $(P)$(R)01b:ReadMeas){
    field(DESC, "Reads the measured rotational speed")
    field(DTYP, "stream")
    field(INP, "@edwards.proto ReadMeas('02') RS485")
    #field(PINI, "YES")
    field(VAL, "22")
    field(SCAN, "2 second")
    field(DISA, "1")
}
record(longout, $(P)$(R)01:SetSpeedSetpoint){
    field(DESC, "Reads the measured rotational speed")
    field( DTYP, "stream" )
    field( OUT,  "@edwards.proto SetSpeedSetpoint('01') $(BUS)")
    # Check Pump rpm rates. rated 35000 ~ 584 Hz
    field( DRVH, "584" )
    # half of rated spped
    field( DRVL, "292" )
    field(EGU, "Hz")
}
#  How to force string as argument to Stream device?
### record(longin, $(P)$(R)01:ReadSpeedSetpoint){
    # field(DESC, "Reads the the Speed Set Point value")
##    # field( DTYP, "stream" )
## field( INP,  "@edwards.proto ReadSpeedSetpoint('01') $(BUS)")
  ## Check Pump rpm rates
  ## half of rated spped
    #field(HIGH, "36000")
    #field(HIHI, "40000")
    #field(VAL, "666")
    #field(EGU, "Hz")
    #field(SCAN, "2 second")
    #field(DISA, "1")
#}
record(longin, $(P)$(R)01:ReadStatus){
  field(DESC, "Reads various setting")
  field(DTYP, "stream" )
  field(INP,  "@edwards.proto ReadStatus('01') $(BUS)" )
  # Check Pump rpm rates
  # half of rated spped
  #field(HIGH, "100")
  #field(HIHI, "110")
  #field(VAL, "1")
  #field(EGU, "C")
 # field(SCAN, "2 second")
    field(SCAN, "2 second")
    field(DISA, "1")
}
# Table 25
record(mbbi, $(P)$(R)01:ReadStatusRMode){
    field(DESC, "Reads the Remote mode operation")
    field(DTYP, "stream" )
    field(INP,  "@edwards.proto ReadStatusRMode('01') $(BUS)" )
    field(VAL, "7")
    field(ZRVL,"0")
    field(ONVL,"1")
    field(ONST,"I/O Remote")
    field(TWVL,"2")
    field(TWST,"COM1")
    field(THVL,"3")
    field(FVVL,"5")
    field(FRVL,"4")
    field(FVST,"COM2")
    field(SXVL,"6")
    field(SXST,"STP-Link")
    field(SVVL,"7")
    field(SVST,"Reserved")
    field(SCAN, "I/O Intr")
    field(DISA, "1")
}
record(longin, $(P)$(R)01:ReadModFonctI){
    field(DESC, "Reads the pump operation mode")
    field(DTYP, "stream" )
    field(INP,  "@edwards.proto ReadModFonct('01') $(BUS)" )
    field(DISA, "1")
    field(SCAN, "2 second")
    field(PINI, "YES")
}
record(mbbi, $(P)$(R)01:ReadModFonct){
    field(DESC, "Reads the pump operation mode")
#    field(DTYP, "stream" )
#    field(INP,  "@edwards.proto ReadModFonct('01') $(BUS)" )
    field(VAL, "11")
    field(ZRVL,"0")
    field(ONVL,"1")
    field(ONST,"Levitation")
    field(TWVL,"2")
    field(TWST,"No Levitation")
    field(THVL,"3")
    field(THST,"Acceleration")
    field(FRVL,"4")
    field(FRST,"Normal")
    field(FVVL,"5")
    field(FVST,"Deceleration")
    field(SXVL,"6")
    field(SXST,"Autotest")
    field(SVVL,"7")
    field(SVST,"Tuning")
    field(EIVL,"8")
    field(EIST,"Tuning Complete")
    field(NIVL,"9")
    field(NIST,"Updating control loop S/W")
    field(TEVL,"10")
    field(TEST,"Waiting Update DriverS/W")
    field(ELVL,"11")
    field(ELST,"Updating Driver S/W")
    field(DISA, "1")
    field(SCAN, "2 second")
    field(PINI, "YES")
}
record(longin, $(P)$(R)01:ReadModFonctNErrors){
    field(DESC, "Reads number of errors being detected")
#    field(DTYP, "stream" )
#    field(INP,  "@edwards.proto ReadModFonctNErrors('01') $(BUS)" )
    field(VAL, "0")
    field(LOPR, "0")
    field(HOPR, "77")
    field(HIGH, "3")
    field(HIHI, "5")
    #field(SCAN, "I/O Intr")
}
record(longin, $(P)$(R)01:ReadModFonctError1){
    field(DESC, "Reads first error being detected")
#    field(DTYP, "stream" )
#    field(INP,  "@edwards.proto ReadModFonctError1('01') $(BUS)" )
    field(VAL, "0")
    field(LOPR, "0")
    field(HOPR, "65")
    field(HIGH, "1")
#    field(HIHI, "5")
#    field(SCAN, "I/O Intr")
}
record(longin, $(P)$(R)01:ReadModFonctError2){
    field(DESC, "Reads second error being detected")
#    field(DTYP, "stream" )
#    field(INP,  "@edwards.proto ReadModFonctError2('01') $(BUS)" )
    field(VAL, "0")
    field(LOPR, "0")
    field(HOPR, "65")
    field(HIGH, "1")
#    field(HIHI, "5")
#    field(SCAN, "I/O Intr")
}
record(mbbi, $(P)$(R)01:ReadModFonctWithWarning){
    field(DESC, "Reads the pump operation mode")
    field(DTYP, "stream" )
    field(INP,  "@edwards.proto ReadModFonctWWarning('01') $(BUS)" )
    field(ZRVL,"0")
    field(ZRST,"0")
    field(ONVL,"1")
    field(ONST,"Levitation")
    field(TWVL,"2")
    field(TWST,"No Levitation")
    field(THVL,"3")
    field(THST,"Acceleration")
    field(FRVL,"4")
    field(FRST,"Normal")
    field(FVVL,"5")
    field(FVST,"Deceleration")
    field(SXVL,"6")
    field(SXST,"Autotest")
    field(SVVL,"7")
    field(SVST,"Tuning")
    field(EIVL,"8")
    field(EIST,"Tuning Complete")
    field(NIVL,"9")
    field(NIST,"Updating control loop S/W")
    field(TEVL,"10")
    field(TEST,"Waiting Update Driver S/W")
    field(ELVL,"11")
    field(ELST,"Updating Driver S/W")
    field(DISA, "1")
    field(SCAN, "2 second")
    #field(SCAN, "10 second")
}
record(longin, $(P)$(R)01:ReadModFonctWWarningNErrors ){
    field(DESC, "Reads number of errors being detected")
    field(DTYP, "stream" )
    field(INP,  "@edwards.proto ReadModFonctWWarningNErrors('01') $(BUS)" )
    field(VAL, "0")
    field(LOPR, "0")
    field(HOPR, "77")
    field(HIGH, "3")
    field(HIHI, "5")
    field(SCAN, "I/O Intr")
}
record(mbbiDirect, $(P)$(R)01:WARNING){
    field(DESC, "Reads WARNING being detected")
    field(DTYP, "stream" )
    field(INP,  "@edwards.proto ReadWarning('01') $(BUS)" )
    field(FLNK, "$(P)$(R)01:WARNING:FANOUT1")
    field(SCAN, "I/O Intr")
}
record(fanout, $(P)$(R)01:WARNING:FANOUT1){
    field(DESC, "WARNING PV Fanout")
    field(LNK1, "$(P)$(R)01:WARNING:BAD-PUMP-TX")
    field(LNK2, "$(P)$(R)01:WARNING:SECOND-DAMGE-LMT")
    field(LNK3, "$(P)$(R)01:WARNING:FIRST-DAMGE-LMT")
    field(FLNK, "$(P)$(R)01:WARNING:FANOUT2")
}
record(fanout, $(P)$(R)01:WARNING:FANOUT2){
    field(DESC, "WARNING PV Fanout")
    field(LNK1, "$(P)$(R)01:WARNING:BAD-PUMP-TX")
#    field(LNK1, "$(P)$(R)01:WARNING:FANOUT")
    field(FLNK, "$(P)$(R)01:WARNING:FANOUT3")
}
record(fanout, $(P)$(R)01:WARNING:FANOUT3){
    field(DESC, "WARNING PV Fanout")
#    field(LNK1, "$(P)$(R)01:WARNING:FANOUT")
}
record(bi, $(P)$(R)01:WARNING:BAD-PUMP-TX){
    field(DESC, "WARNING PV Fanout")
    field(INP, "$(P)$(R)01:WARNING:B0 MSS")
    field( ZNAM, "OFF" )
    field( ONAM, "ON" )
    field(OSV,"MINOR")
}
record(bi, $(P)$(R)01:WARNING:SECOND-DAMGE-LMT){
    field(DESC, "WARNING: Second Damage Limit")
    field(INP, "$(P)$(R)01:WARNING:B1 MSS")
    field( ZNAM, "OFF" )
    field( ONAM, "ON" )
    field(OSV,"MINOR")
}
record(bi, $(P)$(R)01:WARNING:FIRST-DAMGE-LMT){
    field(DESC, "WARNING: First Damage Limit")
    field(INP, "$(P)$(R)01:WARNING:B2 MSS")
    field( ZNAM, "OFF" )
    field( ONAM, "ON" )
    field(OSV,"MINOR")
}

record(mbbo, $(P)$(R)01:Command){
    field( DTYP, "stream" )
    field( OUT,  "@edwards.proto Command('01') $(BUS)" )
  # Check Pump rpm rates
  #field( ZRVL, "0" )
    field( ONVL, "1" )
    field( TWVL, "2" )
    field( FRVL, "4" )
    field( ONST, "START" )
    field( TWST, "STOP" )
    field( FRST, "RESET" )
    field(VAL, "0")
  # half of rated spped
}
record(stringout, $(P)01:generic){
    field(DESC, "Generic")
    field(DTYP, "stream")
    field(OUT, "@edwards.proto debug('01') RS485")
#    field(PINI, "YES")
}
